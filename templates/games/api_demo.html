{% extends 'base.html' %}
{% load static %}
{% block title %}API Demo{% endblock %}
{% block content %}
<h1>Проверка API-ключа</h1>
<p>Введите API-ключ и выполните запрос к <code>/api/games/</code>. Результат появится ниже.</p>

<div style="max-width: 720px;">
  <label for="apiKey">API Key</label>
  <input id="apiKey" type="password" class="form-control" placeholder="введите ваш ключ" />
  <small>Ключ передаётся в пути /api/games/&lt;KEY&gt;/ или как ?api_key=KEY.</small>

  <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
    <button id="btnTestPath" class="btn btn-primary">Список (ключ в пути)</button>
    <button id="btnTestQuery" class="btn btn-secondary">Список (ключ в query)</button>
    <button id="btnTestIdQuery" class="btn btn-secondary">Игра ID=1 (ключ в query)</button>
  </div>

  <pre id="output" style="margin-top: 16px; white-space: pre-wrap; background: #111; color: #ddd; padding: 12px; border-radius: 4px; min-height: 120px;"></pre>
</div>

<script>
(function(){
  const btn = document.getElementById('btnTest');
  const btnId = document.getElementById('btnTestId');
  const out = document.getElementById('output');
  const keyInput = document.getElementById('apiKey');

  async function callApi(url){
    out.textContent = 'Выполняется запрос: ' + url + '...';
    try {
      const res = await fetch(url);
      const text = await res.text();
      out.textContent = 'Статус: ' + res.status + '\n' + text;
    } catch (e) {
      out.textContent = 'Ошибка запроса: ' + (e && e.message ? e.message : e);
    }
  }

  document.getElementById('btnTestPath').addEventListener('click', function(){
    const apiKey = keyInput.value.trim();
    callApi('/api/games/' + encodeURIComponent(apiKey) + '/');
  });
  document.getElementById('btnTestQuery').addEventListener('click', function(){
    const apiKey = keyInput.value.trim();
    callApi('/api/games/?api_key=' + encodeURIComponent(apiKey));
  });
  document.getElementById('btnTestIdQuery').addEventListener('click', function(){
    const apiKey = keyInput.value.trim();
    callApi('/api/games/1/?api_key=' + encodeURIComponent(apiKey));
  });
})();
</script>
{% endblock %}
